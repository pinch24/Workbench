[Blockchain in Action by Bina Ramamurthy, 2020]()

# Part 1. 블록체인 프로그래밍 시작하기
블록체인은 **신뢰 레이어(trust layer)**이다.

#### 블록체인의 컨셉(3D)
- **탈중앙화된(decentralized)**
- **탈중개자(disintermediator)**
- **분산된(distributed)**
위 3D는 스마트 컨트랙트라는 코딩 기술의 도움으로 탈중앙화 애플리케이션에 대한 신뢰를 만들어 낸다.

# Chapter 1. 블록체인 기초
2008년 후반과 2009년 초, 은행과 투자 회사와 같은 대형 중개자가 이끌어 오던 중앙화된 세계 금융시장 시스템이 무너져 내렸다. 이 시스템에 대한 신뢰가 깨지면서 금융시장의 붕괴와 함께 전 세계는 패닉에 빠져들었다. 바로 이 시점에 등장한 실제로 작동 가능한 **피어-투-피어(peer-to-peer) 탈중앙화 디지털 화폐 시스템 모델**이 **비트코인(Bitcoin)**이다. 이 시스템에서 신뢰 중개(trust intermediation)는 이후 **블록체인(blockchain)**이라 불리는 기술로 실현됐다. 블록체인은 화폐 송금을 위한 소프트웨어 기반 **확인, 검증, 저장, 무결성**을 위한 수단 등을 제공했다.

# 1.1 비트코인에서 블록체인으로
블록체인의 트랜잭션은 화폐 외에도 소유권, 증서, 음악, 예술, 비밀 코드, 계약 등 매일 일어나는 일상 활동에서 비롯되는 수많은 것들을 포함한다.

2013년에는 **이더리움(Ethereum)**에 코드를 실행할 수 있는 환경이 추가되었다. 이더리움은 검증, 인증, 저장 능력이 **다른 디지털 자산과 연관된 트랜잭션 시스템으로 확장할 수 있다**는 점에서 혁신을 이루었다.

## 1.2 블록체인이란 무엇인가
블록체인은 **피어 참여자들 간의 트랜잭션으로 이루어진 탈중앙화 시스템에 신뢰를 구축해 주는 기술**이다. 블록체인의 목적은 참여자들이 올린 **트랜잭션을 확인하고 검증해 주고(검증에 실패했을 때는 거부하고), 그 트랜잭션을 실행해 주며, 각 참여자의 동의하에 이러한 행위들의 증거를 기록해 주는 것**이다.

### 1.2.4 블록체인 스택과 프로그래밍 종류
비트코인은 오직 지갑 애플리케이션만을 가지고 있지만, 이더리움은 스마트 컨트랙트라는 프로그래밍이 가능한 코드 기능을 제공한다.

- **프로토콜 레벨 프로그래밍(protocol level programming)**: 블록체인 자체의 **배포와 운영**을 위한 레벨이다.
- **스마트 컨트랙트 레벨 프로그래밍(smart-contract level programming)**: **확인과 검증을 위한 규칙을 설계하고 프로그래밍**하며, 해당 블록체인에 기록할 **데이터와 메시지를 규정하는 스마트 컨트랙트(또는 룰 엔진)** 프로그래밍을 위한 레벨이다.
- **애플리케이션 레벨 프로그래밍(application level programming)**: 블록체인 프로토콜 외부에 있는 **애플리케이션 프레임워크와 유저 인터페이스**를 위한 레벨이다. 애플리케이션과 해당 스마트 컨트랙트를 연결하고 블록체인에 배포한다.

## 1.3 블록체인 프로그래밍
- **탈중앙화된 인프라(decentralized infrastructure)**: 블록체인 프로토콜, 스마트 컨트랙트, 애플리케이션을 지원하는 하드웨어와 소프트웨어 스택이다.
- **분산 장부 기술(distributed ledger technology)**: 인프라에 속한 모든 참여자의 장부에 트랜잭션과 데이터를 동시에 기록한다. 장부는 모든 참여자가 동일한 사실을 저장하고 있기 때문에 분산되어 있다고 할 수 있다. 각 블록은 이전 블록의 서명과 연결되어 있어 변조가 불가능(immutable)하다.
- **탈중개 프로토콜(disintermediation protocol)**: 탈중앙화 시스템의 참여자들은 상호 간에 연결하고 통신하고 거래하기 위해 동일한 블록체인 프로토콜을 사용한다.
- **신뢰 확립자(trust enabler)**: 중개자 없이 관리(governance), 검사(inspection), 준수(compliance) 등에 대한 규칙을 구현하고 처리하는 역할을 블록체인 소프트웨어가 담당한다.

### 1.3.1 블록체인 인프라
#### 탈중앙화 시스템
- 참여자들은 P2P로 소통한다.
- 참여자들은 자신의 자산을 통제한다.
- 참여자들은 자신의 의사에 따라 참여하거나 떠날 수 있다.
- 참여자들은 통상의 신뢰 경계를 넘어서서 행위를 한다.
- 결정은 중앙화 기관이 아니라 분산된 참여자들이 내린다.
- 자동화된 블록체인 소프트웨어가 상호 간 중개를 담당한다.

#### 블록체인 노드, 네트워크, 그리고 애플리케이션
블록체인 노드는 트랙잭션의 엔드포인트로서 작동에 필요한 컴퓨팅 환경을 호스팅하고, 트랜잭션을 릴레이하며, 브로드캐스팅하는 기능을 수행한다.

스마트 컨트랙트는 블록체인 노드가 호스팅하는 샌드박스 환경에서 실행된다.

### 1.3.2 분산 장부 기술(Distributed Ledger Technology, DLT)
#### 트랜잭션, 블록, 그리고 블록의 체인
1. 수집한 네트워크의 트랜잭션들은 검증 단계를 거쳐 풀로 모인다.
2. 참여 노드들은 합의 알고리즘을 사용해 기존 체인에 추가될 트랜잭션들을 포함하는 하나의 블록에 대해 집합적으로 합의한다.
3. 체인의 현재 리드 블록을 나타내는 해시 값을 추가될 블록에 더해서 체인 링크(chain link)를 만든다.

이와같이 블록체인은 추가만 허용하는(append-only) 분산된 변조 불가 장부다.

#### 블록체인 DLT의 특징
- 분산되어 있다. 블록체인 프로토콜은 분산된 각각의 참여 노드들이 동일한 블록의 체인 복사본을 가지고 있다는 것을 보장한다.
- 변조가 불가능하다. 위의 이유로 새로 생성되는 모든 블록은 현재 블록체인 헤드의 해시값을 통해 기존 블록체인에 링크되어 있다.

변조 불가능성을 보장하기 위해 블록 n을 나타내는 서명값이 블록 n+1에 저장되어 있다. 따라서 노드의 데이터에 조금만 변화가 와도 해당 블록의 해시 값은 바뀌고, 결국 그 노드의 체인은 유효하지 않게 된다.

2020년을 기준으로 비트코인 블록 생성 주기, 즉 트랜잭션 컨펌 주기는 약 10분이다. 이더리움에서는 블록 컨펌이 약 10초에서 19초 안에 일어난다. 반면에 신용카드에서는 트랜잭션 컨펌이 1초 안에 이루어진다.

### 1.3.3 탈중개 프로토콜
#### 블록체인 프로토콜의 기능 규정
- 블록체인의 구조: 트랜잭션, 블록, 그리고 블록의 체임
- 암호화, 해싱, 그리고 상태 관리를 위한 기반 알고리즘과 표준
- 블록의 합의와 일관성 있는 체인을 구현하기 위한 방법
- 불일치하는 장부를 초래할 수 있는 예외들을 처리하는 테크닉
- 일관성, 정확성, 변조 불가능성을 유지하기 위한 블록체인의 코드와 규칙들의 실행 환경

블록체인의 구조와 오퍼레이션은 임의적인 것이 아니라 프로토콜에 따른다. 프로토콜 구현은 블록체인 애플리케이션을 만들 베이스 레이어를 확립하는 것이다.

### 1.3.4 신뢰 확립자
블록체인은 인터넷에 신뢰 레이어를 만들어 신뢰 중개를 함으로써 이러한 필요를 충족시킨다. 탈중앙화 인프라, 분산 장부 기술, 탈중개 프로토콜, 이 세 가지의 3D가 집합적으로 시스템에 신뢰를 구축한다.

## 1.4 사용 동기 시나리오
정부와 비정부기구, 자선단체와 재난구호기구 등의 크고 작은 조직의 **예산과 비용 관리**에서 **회계 책임(accountability)**이 중요한 이슈가 된다.
- 할당 예산을 지정한 아이템이나 서비스에 사용했는가?
- 예상한 결과를 실현했는가?
- 지출을 낭비한 것은 아닌가?
- 적절한 사람들이 이를 허가했는가?
- 재난 구호 시 지급한 명세를 보여줄 수 있는가?
- 그 프로세스는 투명한가?
- 그 노력의 효과성을 보여줄 정확한 데이터를 수집할 수 있는가?

### 1.4.1 자동화되고 일관성 있는 데이터 수집
여러 가지 보고와 데이터 수집 메커니즘을 활용해 그 목표와 관련한 비용을 추적한다. 여기서 관심 대상 항목들을 DLT 장부에 기록한다고 할 때 필요한 항목들은 다음과 같다.
- 각 에이전시에 할당한 자금과 지급 날짜
- 에이전시로부터 실제 자금 사용자로 송금한 시작 날짜와 금액
- 프로젝트 완료 날짜와 상태

스마트 컨트랙트에 의해 작동되는 코드는 조직의 자금을 분배하고 사용할 때 데이터를 자동으로 수집할 수 있도록 해준다. 애플리케이션은 스마트 컨트랙트 함수를 호출해서 분산되고 변조 불가능한 활동 명세 복사본을 블록체인 장부에 저장할 수 있도록 한다. 이로써 모든 이해 당사자들은 자동으로 일관성 있는 장부의 복사본을 갖게 되는 것이다.

### 1.4.2 시의적절한 정보 공유
블록체인 시스템의 한 노드에서 업데이트가 일어나면 다른 노드에도 자동으로 업데이트된다.

공유 규칙, 조건, 접근 레벨 등은 스마트 컨트랙트에 코딩할 수 있고, 관련 정보를 다시 블록체인의 분산 장부에 기록할 수 있다.

### 1.4.3 검증 가능한 준수
스마트 컨트랙트에 규칙 준수 내용을 코딩할 수 있고, 이해 당사자들의 블록체인 노드에 자동으로 기록할 수 있으며, 원치 않는 민감한 데이터의 유출을 방지할 수 있다. 관련 비즈니스들은 검증 가능한 준수 여부를 확인할 수 있다. 또한, 블록체인은 규제 당국에도 이러한 준수 내용을 보여주는 매커니즘을 제공할 수 있다.

### 1.4.4 증명을 위한 감사 가능한 행위
종종 어떤 행위나 중재가 적절한 시간에 이루어졌는가 하는 질문을 재기할 때가 있다. 스마트 컨트랙트는 적시에 특정한 행동을 했다는 것을 증명하는 자료가 될 수 있다.

스마트 컨트랙트가 생성한 분산 장부는 적절한 행위가 취해졌음을 증명하는 감사 가능한 기록을 제공한다.

### 1.4.5 거버넌스를 위한 지침

### 1.4.6 행위 귀속
블록체인 시스템에서는 행위들의 귀속, 즉 누가 누구에게 무엇을 한 것인지를 정확히 파악 할 수 있다.

스마트 컨트랙트는 전통적인 분산 시스템을 탈중앙화 시스템으로 탈바꿈시키는데, 이것은 준수, 거버넌스, 증명을 위한 규칙을 만들고, 정보를 공유하며, 필요한 상세 정보를 블록체인에 기록함으로써 이루어진다.

### 1.4.7 유행병 관리

# Chapter 2. 스마트 컨트랙트
블록체인 시스템에서 스마트 컨트랙트는 탈중앙화 문제들을 풀기 위한 컨트랙트 규칙들을 구현한다. 게이트키퍼로서뿐만 아니라 규칙 엔진으로서도 작동하므로 스마트 컨트랙트를 설계할 때 신중하게 고려해야 한다.

스마트 컨트랙트는 애플리케이션의 규칙과 규정들을 디지털로 정의하고, 검증하고, 검사하며, 강제하기 위한 블록체인에서 작동시킬 수 있는 실행 가능한 코드다. 스마트 컨트랙트는 제3자 없이도 신뢰할 수 있는 트랜잭션의 수행을 지원한다. 이런 트랜잭션은 추적 가능하고 되돌릴 수 없다.

스마트 컨트랙트 구현
- 블록체인 플랫폼
- 스마트 컨트랙트를 코딩하기 위한 언어
- 개발, 컴파일, 배포, 테스트하기에 적합한 환경

## 2.1 스마트 컨트랙트 개념
**스마트 컨트랙트**는 암호 화폐 이외의 디지털 자산을 위한 **트랜잭션을 지원할 수 있는 프로그래밍**을 가능하게 해준다. 스마트 컨트랙트는 각 블록체인 애플리케이션이 필요로 하는 특정한 확인과 검증을 가능하게 한다. 범용적인 애플리케이션을 위한 블록체인의 신뢰 레이어를 열어 주는 것이다.

### 2.1.1 비트코인 트랜잭션 vs 스마트 컨트랙트 트랜잭션
비트코인의 경우, 모든 트랜잭션은 가치(Tx(sendValue))를 전송하기 위한 것이다. 스마트 컨트랙트를 지원하는 블록체인의 경우, 트랜잭션은 스마트 컨트랙트가 구현한 기능을 임베드한다. 예를 들어 투표 기능의 스마트 컨트랙트에는 validateVote(), vote(), count(), declareWinner()와 같은 함수를 구현할 수 있다. 이들 함수를 호출하면 블록체인에 기록될 트랜잭션들(Tx(validateVote), Tx(vote) 등)을 생성한다. 블록체인에 이러한 임의적인 코드를 올리고 실행할 수 있는 기능으로 블록체인의 활용도를 크게 향상시킨다.

### 2.1.2 스마트 컨트랙트는 무엇을 하나?
- 각 애플리케이션의 조건에 맞는 확인과 검증을 할 수 있는 비즈니스 로직 레이어를 표현한다.
- 블록체인에서 작동하기 위한 규칙의 명세(specification of rules)를 설정할 수 있게 한다.
- 탈중앙화 네트워크에서 자산의 전송을 위한 정책을 구현하기 쉽도록 한다.
- 메시지나 다른 함수의 호출에 의해 실행되는 함수를 내장하는데, 개인 어카운트나 다른 스마트 컨트랙트 어카운트가 이 함수를 호출하게 된다. 이 메시지는 블록체인의 분산 장부에 트랜잭션의 일부로 기록되는데, 여기에는 입력 파라미터, 송신자의 주소, 타임스탬프 등과 같은 추가적인 메타 데이터를 포함한다.
- 탈중앙화 블록체인 기반 애플리케이션을 위한 소프트웨어 기반 중개자로서 기능한다.
- 스마트 컨트랙트 기능의 구체적인 설정을 통해 블록체인에게 프로그래밍 가능성(programmability)와 지능성을 제공해 준다.

## 2.2 스마트 컨트랙트의 설계

